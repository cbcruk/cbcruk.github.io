---
tags: [vitest, mock, testing]
status: release
ctime: 2025-12-28
mtime: 2025-12-28
---

Vitest 모킹: `vi.mocked()` vs `vi.hoisted()`

`vi.mocked()`는 타입만 제공, 실제 모킹 구현체는 별도로 필요.

```typescript
// ❌ mockImplementation이 undefined
const mockUseSize = vi.mocked(useSize)

// ✅ vi.hoisted() 사용 (추천)
const mockUseSize = vi.hoisted(() => vi.fn())

vi.mock('ahooks', () => ({ useSize: mockUseSize }))

beforeEach(() => {
  mockUseSize.mockImplementation(() => ({ width: 100, height: 20 }))
})
```

DOM 속성 모킹 (scrollWidth/clientWidth):

```typescript
beforeEach(() => {
  Object.defineProperty(HTMLElement.prototype, 'scrollWidth', {
    configurable: true,
    get() {
      return 150
    },
  })
})

afterEach(() => {
  // 원래 속성 복원
})
```

DOM 측정이 복잡하면 Playwright/Cypress로 통합 테스트 고려.
