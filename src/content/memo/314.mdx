---
tags: ['date', 'random', 'test', 'flaky']
status: release
ctime: 2024-09-01
mtime: 2024-01-09
---

Flaky 테스트 방지 - `Date`, `Math.random` 같은 비순수 함수를 props로 주입

- `new Date()`, `Math.random()` 같은 비순수 함수는 매번 다른 결과 → 테스트 불안정
- 해결: 기본 매개변수로 주입하면 프로덕션 동작 유지 + 테스트에서 제어 가능

```js
function Date({ date = new Date() }) {
  const [date, setDate] = React.useState(date)

  return (
    <input
      type="date"
      onChange={(e) => setDate(e.target.value)}
      defaultValue={date}
    />
  )
}

function Random({ randomizer = Math.random }) {
  const [state, setState] = React.useState(randomizer())

  return <div>{state}</div>
}
```

테스트:

```tsx
describe('Date Component', () => {
  it('should update state on date change', () => {
    render(<Date date={new Date('2023-01-01')} />)

    const input = screen.getByRole('textbox')

    expect(input.value).toBe('2023-01-01')
  })
})

describe('Random Component', () => {
  it('should render a random number', () => {
    const mockRandomizer = () => 0.5

    render(<Random randomizer={mockRandomizer} />)

    const div = screen.getByText('0.5')

    expect(div).toBeInTheDocument()
  })
})
```
