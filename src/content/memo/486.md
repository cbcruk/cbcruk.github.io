---
tags: ['reducer']
status: draft
ctime: 2025-03-05
mtime: 2025-03-05
---

```tsx
/**
 * @description
 * - https://github.com/kentcdodds/advanced-react-hooks
 * - https://github.com/kentcdodds/advanced-react-patterns
 */

import * as React from 'react'

type State = { count: number }

type Action =
  | { type: 'increment'; step?: number }
  | { type: 'decrement'; step?: number }

type UseCountReducer = ReturnType<typeof useCountReducer>

type Dispatch = UseCountReducer[1]

function useCountReducer({ step = 1, initialCount = 0 }) {
  const reducer: React.Reducer<State, Action> = (state, action) => {
    const change = action.step ?? step

    switch (action.type) {
      case 'increment': {
        return { ...state, count: state.count + change }
      }
      case 'decrement': {
        return { ...state, count: state.count - change }
      }
      default: {
        throw new Error(`Unhandled action type: ${JSON.stringify(action)}`)
      }
    }
  }
  const [state, dispatch] = React.useReducer(reducer, {
    count: initialCount,
  })

  return [state, dispatch] as const
}

function useCounter() {
  const context = React.useContext(CounterContext)

  if (context === undefined) {
    throw new Error(`useCounter must be used within a CounterProvider`)
  }

  return context as NonNullable<typeof context>
}

const increment = (dispatch: Dispatch) => dispatch({ type: 'increment' })
const decrement = (dispatch: Dispatch) => dispatch({ type: 'decrement' })

const CounterContext = React.createContext<UseCountReducer | null>(null)

function CounterProvider({ step = 1, initialCount = 0, ...props }) {
  const [state, dispatch] = useCountReducer({})

  return <CounterContext.Provider value={[state, dispatch]} {...props} />
}

function Counter() {
  const [state, dispatch] = useCounter()

  return (
    <div>
      <div>Current Count: {state.count}</div>
      <button onClick={() => decrement(dispatch)}>-</button>
      <button onClick={() => increment(dispatch)}>+</button>
    </div>
  )
}

function App() {
  return (
    <CounterProvider>
      <Counter />
    </CounterProvider>
  )
}
```
